//GENERAL
var ticker = 0;

//IDEA
var ideaTimer = null;
var creativity = 1; //creativity level
var rangeIdea = 5; //value of Qt on range
var ideaQl =  5; //value of Ql on range
var ideasQt = 0; //amount of ideas ready to edit
var ideasQtTotal = 0; //amount of ideas since beginning NOT USED YET

//SHOOT AND EDIT
var shootEdit = 10; //
var shootEditRem = 10; //number of remaining clicks
var videosEdited = 0; //number of videos edited
var computerMemory = 6; //max videos edited 

//UPLOAD
var ideaQlArray = new Array();
var videosUploaded = 0; //Videos online
var averageQlNum = 0; //average Ql numerator
var averageQl = 0; //average video quality after upload

//SUBS
var views = 11;
var likeDislikeRatio = 0;
var subscribers = 0;

//CASH
var adAmount = 0;
var cashAmount = 100;

//COMMENTS
var comments = [
  {name: "good", type: "positive"},
  {name: "great", type: "positive"},
  {name: "toll", type: "positive"},
  {name: "gay", type: "negative"},
  {name: "unsub", type: "negative"},
  {name: "trash", type: "negative"}
  ];
var commentBox = [{comment:"",source:""},
                  {comment:"",source:""},
                  {comment:"",source:""},
                  {comment:"",source:""},
                  {comment:"",source:""},
                  {comment:"",source:""},
                  {comment:"",source:""},
                  {comment:"",source:""},
                  {comment:"",source:""},
                  {comment:"",source:""},
                  ];

//PAGE LOAD FUNCTIONS
memoryBlockRefresh();//refreshes the memory block canvas

//TIMERS
  //Function for ticker
function autoticker(number){
  ticker = ticker + number
  document.getElementById("ticker").innerHTML = ticker;
}

  //start timer1
function startTimer1(){
  ideaTimer = setInterval(function(){
              autoticker(1);
              ideasGen();
              },3000);
}

  //start timer2 _ NOT A FUNCTION
window.setInterval(function(){
                   SubsRefresh();
                   viewsRefresh();
                   cashGen();
                   },1000);

  //stop timers
function stopTimers() {
  clearInterval(ideaTimer);
}



//Function to manually add views
function addition(number){
  views = views + number;
  views = Math.floor(views);
  document.getElementById("views").innerHTML = views;
}

//Upgrade CREATIVITY according to views
function upgradeCreativity(){
  var upCost = Math.floor(10* Math.pow(1.2,creativity));
    if(views >= upCost){
     creativity += 1;
     views -= upCost;
     document.getElementById("views").innerHTML = views;
     document.getElementById("creativityLvl").innerHTML = "Lvl : " + creativity;
   }
  var nextCost = Math.floor(10 * Math.pow(1.2,creativity));
  document.getElementById('upgradeCreativityCost').innerHTML = "<em> Cost </em>: " + nextCost;
}

//idea range
function ideaRangeMax(rangeValue) {
  rangeIdea = rangeValue; //stores range value quantity
  document.getElementById("idea").innerHTML = rangeValue;
  var maxRangeValue = creativity + 9; //increases slider max value
  document.getElementById("ideaRange").max = maxRangeValue;
  ideaQl = maxRangeValue - rangeValue;
  document.getElementById("ideaQl").innerHTML = ideaQl;
}

//Adds up range value quantities in ideas generated and calculates Ql array
function ideasGen() {
  rangeIdea = parseInt(rangeIdea);
  var arrayAdd = newArray(ideaQl, rangeIdea);
  ideaQlArray = ideaQlArray.concat(arrayAdd);
  document.getElementById("arrayQl").innerHTML = ideaQlArray;
  ideasQt = ideasQt + rangeIdea;
  document.getElementById("ideasGen").innerHTML = ideasQt;
  ideasQtTotal = parseInt(rangeIdea) + ideasQtTotal;
  document.getElementById("ideasGenTotal").innerHTML = ideasQtTotal;
}

//to de-group Qt into correct array
function newArray(value, len) {
  var arr = [];
    for (var i = 0; i < len; i++) {
       arr.push(value);
      }
  return arr;
}

//Shoot & Edit
function clicksLeft(){
  if(shootEditRem > 0 && ideasQt>0){
    shootEditRem -= 1 ;
    document.getElementById("editClicks").innerHTML = shootEditRem;
   }
  else if(shootEditRem == 0 && ideasQt > 0 && videosEdited < computerMemory){
    shootEditRem = shootEdit;
    document.getElementById("editClicks").innerHTML = shootEditRem; 
    videosEdited = videosEdited + 1;
    document.getElementById("videosEdited").innerHTML = videosEdited;
    ideasQt = ideasQt - 1;
    document.getElementById("ideasGen").innerHTML = ideasQt;
    }
  var clicksPercentage = Math.round((1-shootEditRem/shootEdit)*100);
  setPercentage(clicksPercentage);
  memoryBlockRefresh();
}

function memoryBlockRefresh() {
  var memoryCanvas = document.getElementById("memoryCanvas");
  var ctx = memoryCanvas.getContext("2d");
  ctx.clearRect(0,0,memoryCanvas.width,memoryCanvas.height);
  memoryEmpty();
  memoryFill();
}

//draws emptymemory squares
function drawMemory(x, y, w, h){
    var cns1 = document.getElementById("memoryCanvas");
    var ctx = cns1.getContext("2d");
      //ctx.fillStyle = "black";
      ctx.beginPath();
      ctx.rect(x, y, w, h);
      ctx.stroke();
}

//draws empty memory slots at start
function memoryEmpty(){
  var width = memoryCanvas.width;
  var height = memoryCanvas.height;
  var numberSquares = computerMemory;
   for (var j=0; j<3; j++){
     let squaresHeight = 10+50*j+30;
     if (numberSquares>0 && squaresHeight<height) {
      for ( var i=0; i < 20; i++) {
      let squaresWidth = 10+40*i+30;
        if (numberSquares>0 && squaresWidth<width) {
        drawMemory(10+40*i,10+50*j,30,30);
        numberSquares -= 1;
        }
      }
     }
   }
}

//draws memory squares
function drawSquare(x, y, w, h){
    var cns1 = document.getElementById("memoryCanvas");
    var ctx = cns1.getContext("2d");
    ctx.fillStyle = "black";
    ctx.fillRect(x,y,w,h);
}

//draws memory squares in canvas
function memoryFill() {
  var width = memoryCanvas.width;
  var height = memoryCanvas.height;
  var numberSquares = videosEdited
   for (var j=0; j<3; j++){
     let squaresHeight = 10+50*j+30;
     if (numberSquares>0 && squaresHeight<height) {
      for ( var i=0; i < 20; i++) {
      let squaresWidth = 10+40*i+30;
        if (numberSquares>0 && squaresWidth<width) {
        drawSquare(10+40*i,10+50*j,30,30);
        numberSquares -= 1;
        }
      }
     }
   }
}

//Upgrade MEMORY according to cashAmount
function upgradeMemory(){
  var upCost = Math.floor(10* Math.pow(1.2,computerMemory));
    if(cashAmount >= upCost){
     computerMemory += 1;
     cashAmount -= upCost;
     document.getElementById("cashAmount").innerHTML = "$" + cashAmount;
     document.getElementById("computerMemory").innerHTML = computerMemory + "Gb";
   }
  var nextCost = Math.floor(10 * Math.pow(1.2,computerMemory));
  document.getElementById('upgradeMemoryCost').innerHTML = "<em> Cost </em>: " + "$" + nextCost;
  memoryBlockRefresh();
}

//Upload video
function uploadVideo() {
 var loadState = 0;
   if (videosEdited > 0 && loadState == 0) {
     loadState = 1;
     document.getElementById("uploadB").disabled = true; 
     var elem = document.getElementById("myBar");
     var width = 1;
     var id = setInterval(frame, 10);
 function frame() {
   if (width >= 100) {
     clearInterval(id);
     loadState = 0;
     elem.style.width = 0 + "%";
     videosUploaded++;
     document.getElementById("videos").innerHTML = videosUploaded;
     videosEdited--;
     document.getElementById("videosEdited").innerHTML = videosEdited;
     averageQlCalculation();//calculated average Ql at each upload
     LDR();//calculated new ratio at each upload
     SubsFromUpload();//calculated sub count at each upload
     viewsFromSubs();//calculated view count at each upload
     memoryBlockRefresh();//refreshes the memory block canvas
     document.getElementById("uploadB").disabled = false; 
     } 
   else {
     width++;
     elem.style.width = width + "%";
     }
   }
 }
}

//calculate average video quality
function averageQlCalculation(){
  var nextQl = ideaQlArray[0];
  averageQlNum = averageQlNum + nextQl;
  averageQl = averageQlNum/videosUploaded;
  ideaQlArray.shift();
  document.getElementById("averageQl").innerHTML = averageQl;
  document.getElementById("arrayQl").innerHTML = ideaQlArray;
}

//increase ad load
function addAdLoad(number){
    if (adAmount < 5){
      adAmount++;
      LDR();
    }
  document.getElementById("adLoad").innerHTML = adAmount;
}

//decrease ad load
function subAdLoad(number){
    if (adAmount > 0){
      adAmount--; 
      LDR();
    }
  document.getElementById("adLoad").innerHTML = adAmount;
}

//Like Dislike ration calculation
function LDR() {
  likeDislikeRatio = Math.floor(averageQl*10 - adAmount*10); 
    if (likeDislikeRatio < 0){
     likeDislikeRatio = 0;
    } 
    else if (likeDislikeRatio > 100){
     likeDislikeRatio = 100;
    }
  document.getElementById("likeDislikeRatio").innerHTML = likeDislikeRatio + "%";
}

//increase subscriber count
function SubsFromUpload(){
  var subInitial = subscribers;
    if(likeDislikeRatio >= 50){
      subscribers += videosUploaded * parseInt(likeDislikeRatio/10);
    }
    else {
      subscribers -= videosUploaded * parseInt(likeDislikeRatio/10);
    }
    if (subscribers < 0){
      subscribers = 0;
    }
  var subsRound = subscribers.toFixed();
  document.getElementById("subscriberAmount").innerHTML = subsRound;
  var subDiff = subscribers - subInitial;
  subDifferenceColor(subDiff);
}

//subs from ticker
function SubsRefresh(){
  var subInitial = subscribers;
    if(likeDislikeRatio >= 50){
      subscribers += videosUploaded * parseInt(likeDislikeRatio/10)*0.01;
    }
    else {
      subscribers -= videosUploaded * parseInt(likeDislikeRatio/10)*0.01;
    }
    if (subscribers < 0){
      subscribers = 0;
    }
  var subsRound = subscribers.toFixed();
  document.getElementById("subscriberAmount").innerHTML = subsRound;
 //var subDiff = subscribers - subInitial;
 //subDifferenceColor(subDiff);
}

//subs difference formatting
function subDifferenceColor(v){
    var vRound = v.toFixed();
    var element = document.getElementById("subDifference");
    var clone = element.cloneNode(true);
    element.parentNode.replaceChild(clone, element);
    if(v < 0){
      clone.innerHTML = vRound;
      clone.classList.remove("animatedGreen");
      clone.classList.add("animatedRed");
    }
    else{
      clone.innerHTML = "+"+vRound;
      clone.classList.remove("animatedRed");
      clone.classList.add("animatedGreen");
    }
}

//Views from subs
function viewsFromSubs(){
  views += subscribers;
  views = Math.floor(views);
  document.getElementById("views").innerHTML = views;
}

//views calculation
function viewsRefresh(){
  views += 0.05*subscribers;
  var viewsRound = views.toFixed();
  document.getElementById("views").innerHTML = viewsRound;
}

//videos * adload = cash
function cashGen(){
  cashAmount += 0.0001*videosUploaded*views*adAmount;
  var cashAmountRound = cashAmount.toFixed(2);
  document.getElementById("cashAmount").innerHTML = "$"+cashAmountRound;
}

//function for cicular progress bar
function setPercentage(v){
  $('.mask span').html(v+'%');
  var perct = v*3.6;
    if(v >= 50){
       $('.right-block').css('background','inherit'); 
       perct = perct - 180;
    }
    else{
       $('.right-block').css('background','#ccc'); 
    }
  $('.right-block').css('transform','rotate('+perct+'deg)'); 
}

//call comments
function callComment(){
  commentBox.unshift({comment:commentType(),source:"callComment"});
  commentArrayShift();
}
  
//décaler comments
function commentArrayShift(){
  var i = 0;
  do {
     var commentId = "comment" + (i+1);
      commentStyle(commentBox[i].source,commentId);
      document.getElementById(commentId).innerHTML = commentBox[i].comment;
      i++;
  } while(i < 10);
  
  if (commentBox.length > 10){
      commentBox.pop();
  }
}

//comment css style
function commentStyle(commentSource,id){
  var element = document.getElementById(id);
  if(commentSource == "callComment"){
    element.classList.remove("projectCommentcolor");
    element.classList.add("callCommentcolor");
  }
  else if (commentSource == "callProject"){
    element.classList.remove("callCommentcolor");
    element.classList.add("projectCommentcolor");
  }
}

//generate random positive or negative comment
function commentType() {
  var com;
  if (likeDislikeRatio >= 50){
     var positiveComment = comments.filter(function(e) {
     return e.type === "positive";
     });
      let x = getRandomInt(0,positiveComment.length)
      com = positiveComment[x].name;
  }else{
      var negativeComment = comments.filter(function(e) {
      return e.type === "negative";
      });
      let x = getRandomInt(0,negativeComment.length)
      com = negativeComment[x].name;
  }
  return com;
}

//Gets a random integer between `min` and `max` 
function getRandomInt(min, max) {
  return Math.floor(Math.random() * (max - min) + min);
}

//project arrays
var ideaProjects = [
  ["views>10", "Casey Shoutout", "10 views required", "views+=10000", "damn casey's your boy [<em>+10000 views</em>]"],
  ["views>15", "RWJ shoutout", "15 views required", "views+=30000", "damn ray's your boy [<em>+30000 views</em>]"],
  ["subscribers>10", "Extra pocket money", "10 subs required", "cashAmount+=1000", "make it rain [<em>+1000 cash</em>]"],
  ["views<10", "End of projects", "congrats", "views+=1", "end of projects"],
];
var shootEditProjects = [
  ["views>10", "Casey Shoutout", "10 views required", "views+=10000", "damn casey's your boy [<em>+10000 views</em>]"],
  ["views>15", "RWJ shoutout", "15 views required", "views+=30000", "damn ray's your boy [<em>+30000 views</em>]"],
  ["subscribers>10", "Extra pocket money", "10 subs required", "cashAmount+=1000", "make it rain [<em>+1000 cash</em>]"],
  ["views<10", "End of projects", "congrats", "views+=1", "end of projects"],
];
var uploadProjects = [
  ["views>10", "Casey Shoutout", "10 views required", "views+=10000", "damn casey's your boy [<em>+10000 views</em>]"],
  ["views>15", "RWJ shoutout", "15 views required", "views+=30000", "damn ray's your boy [<em>+30000 views</em>]"],
  ["subscribers>10", "Extra pocket money", "10 subs required", "cashAmount+=1000", "make it rain [<em>+1000 cash</em>]"],
  ["views<10", "End of projects", "congrats", "views+=1", "end of projects"],
];
var subProjects = [
  ["views>10", "Casey Shoutout", "10 views required", "views+=10000", "damn casey's your boy [<em>+10000 views</em>]"],
  ["views>15", "RWJ shoutout", "15 views required", "views+=30000", "damn ray's your boy [<em>+30000 views</em>]"],
  ["subscribers>10", "Extra pocket money", "10 subs required", "cashAmount+=1000", "make it rain [<em>+1000 cash</em>]"],
  ["views<10", "End of projects", "congrats", "views+=1", "end of projects"],
];
var cashProjects = [
  ["views>10", "Casey Shoutout", "10 views required", "views+=10000", "damn casey's your boy [<em>+10000 views</em>]"],
  ["views>15", "RWJ shoutout", "15 views required", "views+=30000", "damn ray's your boy [<em>+30000 views</em>]"],
  ["subscribers>10", "Extra pocket money", "10 subs required", "cashAmount+=1000", "make it rain [<em>+1000 cash</em>]"],
  ["views<10", "End of projects", "congrats", "views+=1", "end of projects"],
];


//Call Projects
function callProject(array,title,desc,num) {
  var projectTitle = title.id;
  var projectDesc = desc.id;
    if (eval(array[0][0]) == true && array.length>0) {
        eval(array[0][3]);
        commentBox.unshift({comment:array[0][4],source:"callProject"});
        commentArrayShift();
        array.shift();
        flickAppear("project",num);
        document.getElementById(projectTitle).innerHTML = array[0][1];
        document.getElementById(projectDesc).innerHTML = array[0][2];
  }
}

//flickering effect on appearing objects
function flickAppear(class1,num) {
  var element = document.getElementsByClassName(class1)[num];
  var clone = element.cloneNode(true);
  element.parentNode.replaceChild(clone, element);
  clone.classList.remove("animated");
  clone.classList.add("animated");
}
